version: '3'

services:

  freeipa:
    image: freeipa/freeipa-server:centos-7-4.6.8
    hostname: freeipa.aimc.io
    sysctls:
      net.ipv6.conf.all.disable_ipv6: 0
    volumes:
      - /opt/ipadata:/data:Z
      - /sys/fs/cgroup:/sys/fs/cgroup:ro
    command:
      - ipa-server-install
      - --unattended
      - --realm=AIMC.IO
      - --no-ntp
      - --mkhomedir
      - --no_hbac_allow
      - --no-ssh
      - --no-sshd
      - --ds-password=jCfs6zRbtr!JyQop
      - --admin-password=v*LwrufctFa3Fkdu
    restart: always

  nginx:
    image: nginx:1.15-alpine
    ports:
      - "80:80"
      - "443:443"
      - "636:636"      
    volumes:
      - /opt/nginx:/etc/nginx
      - /etc/letsencrypt:/etc/letsencrypt